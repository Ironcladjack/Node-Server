<!DOCTYPE html>
<html lang="en">
<head>
 <title>Bootstrap Example</title>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
</head>
<style>

body {
background: beige;
}

* {
  margin: 0;
  padding: 0;
}

.device-container {
  padding: 10px;
  width: 100%;
  min-height: 10px;
}

.device {
  background: skyblue;
  border: solid 2px white;
  text-align: center;
}

.colour-swatch {
  background: green;
  margin: 2%;
  width: 96%;
  height: 96%;
}

.colour-submit {
  width: 80px;
  height: 30px;
}

.slider {
  width: 100%;
  display: block;
  margin: 5px;
}
 *:hover {
border: solid 1px grey;
}
</style>
<script>
var socket = io(); //load socket.io-client and connect to the host that serves the page

var AngularApp = angular.module('Angular', []);
AngularApp.controller('deviceCtrl', function($scope) {
      $scope.devices = ["1","3","4"];
      $scope.red = 240;
      $scope.green = 200;
      $scope.blue = 140;
      $scope.brightness = 80;
});

//window.addEventListener("load", function(){ //when page loads
$(document).ready(function() {
  var rSlider = document.getElementById("redSlider");
  var gSlider = document.getElementById("greenSlider");
  var bSlider = document.getElementById("blueSlider");
  var brightnessSlider = document.getElementById("brightnessSlider");

  var rgb = {"device":3,"red":240,"green":200,"blue":140,"brightness":80,};


$(".device").dblclick(function() {
  if (rgb.brightness < 5) {
    rgb.brightness = 100;
  } else {
    rgb.brightness = 0;
  };
  brightnessSlider.value = rgb.brightness;
  socket.emit("rgbLed", rgb);
});


  $(".device").click(function() {
    $("body").append("hey");
    let newDevice = $(this).attr("value");
    $("body").append(newDevice);
    rgb.device = newDevice;
    socket.emit("rgbLed", rgb);
  });

  rSlider.addEventListener("change", function() { //add event listener for when red slider changes
    rgb.red = this.value; //update the RED color according to the slider
    //socket.emit("rgbLed", rgb); //send the updated color to RGB LED via WebSocket
  });

  gSlider.addEventListener("change", function() { //add event listener for when green slider changes
    rgb.green = this.value; //update the GREEN color according to the slider
    //socket.emit("rgbLed", rgb); //send the updated color to RGB LED via WebSocket
  });
  bSlider.addEventListener("change", function() { //add event listener for when blue slider changes
    rgb.blue = this.value;  //update the BLUE color according to the slider
    //socket.emit("rgbLed", rgb); //send the updated color to RGB LED via WebSocket
  });
  brightnessSlider.addEventListener("change", function() { //add event listener for when blue slider changes
    rgb.lightness = this.value;  //update the BLUE color according to the slider
    //socket.emit("rgbLed", rgb); //send the updated color to RGB LED via WebSocket
  });
});

socket.on('piTemperatureUpdate', function(piTemp, roomTemp) {
	document.getElementById("PiTemp").innerHTML = "Raspberry Pi Temp: "+piTemp;
  document.getElementById("RoomTemp").innerHTML = "Room Temp: "+roomTemp;
});
</script>
<body>
  <div class="container-fluid" ng-app="Angular">
    <h1>Control Hub:</h1>
    <div class="row" ng-controller="deviceCtrl">
      <div class="col">
        <div class="row">
          <div class="col">
            <div class="row">Lights</div>
            <div class="row"><div class="col device" value="{{x}}" ng-repeat="x in devices" >{{x}}</div></div>
          </div>
        </div>
        <div class="row device-container">
          <input type="range" min="0" max="255" ng-model="red" class="slider" id="redSlider">
          <input type="range" min="0" max="255" ng-model="green" class="slider" id="greenSlider">
          <input type="range" min="0" max="255" ng-model="blue" class="slider" id="blueSlider">
          <input type="range" min="0" max="100" ng-model="brightness" class="slider" id="brightnessSlider">
        </div>
      </div>
      <div class="col-sm-2"><div id="swatch" style="background: rgb({{red}},{{green}},{{blue}}); height: 100%; padding: 10px;"></div></div>
    </div>
  </div>
  <p id="PiTemp"></p>
  <p id="RoomTemp"></p>
</body>
</body>
</html>
