<!DOCTYPE html>
<html lang="en">
<head>
 <title>Homepage</title>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-route.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
</head>
<style>


input[type=range] {
  -webkit-appearance: none; /* Hides the slider so that custom slider can be made */
  width: 100%; /* Specific width is required for Firefox. */
  background: transparent; /* Otherwise white in Chrome */
}

input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
}

input[type=range]:focus {
  outline: none; /* Removes the blue border. You should probably do some kind of focus styling for accessibility reasons though. */
}

input[type=range]::-ms-track {
  width: 100%;
  cursor: pointer;

  /* Hides the slider so custom styles can be added */
  background: transparent;
  border-color: transparent;
  color: transparent;
}

/* Special styling for WebKit/Blink */
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  border: 1px solid #000000;
  height: 36px;
  width: 16px;
  border-radius: 3px;
  background: #ffffff;
  cursor: pointer;
  margin-top: -14px; /* You need to specify a margin in Chrome, but in Firefox and IE it is automatic */
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d; /* Add cool effects to your sliders! */
}

/* All the same stuff for Firefox */
input[type=range]::-moz-range-thumb {
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  border: 1px solid #000000;
  height: 36px;
  width: 16px;
  border-radius: 3px;
  background: #ffffff;
  cursor: pointer;
}

/* All the same stuff for IE */
input[type=range]::-ms-thumb {
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  border: 1px solid #000000;
  height: 36px;
  width: 16px;
  border-radius: 3px;
  background: #ffffff;
  cursor: pointer;
}

input[type=range]::-webkit-slider-runnable-track {
  width: 100%;
  height: 8.4px;
  cursor: pointer;
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  background: #3071a9;
  border-radius: 1.3px;
  border: 0.2px solid #010101;
}

input[type=range]:focus::-webkit-slider-runnable-track {
  background: #367ebd;
}

input[type=range]::-moz-range-track {
  width: 100%;
  height: 8.4px;
  cursor: pointer;
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  background: #3071a9;
  border-radius: 1.3px;
  border: 0.2px solid #010101;
}

input[type=range]::-ms-track {
  width: 100%;
  height: 8.4px;
  cursor: pointer;
  background: transparent;
  border-color: transparent;
  border-width: 16px 0;
  color: transparent;
}
input[type=range]::-ms-fill-lower {
  background: #2a6495;
  border: 0.2px solid #010101;
  border-radius: 2.6px;
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
}
input[type=range]:focus::-ms-fill-lower {
  background: #3071a9;
}
input[type=range]::-ms-fill-upper {
  background: #3071a9;
  border: 0.2px solid #010101;
  border-radius: 2.6px;
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
}

input[type=range]:focus::-ms-fill-upper {
  background: #367ebd;
}


body {
background: beige;
}

* {
  margin: 0;
  padding: 0;
}

.header-bar {
  background: white;
  padding: 0 10px;
  border-bottom: solid 1px black;
}

.header-title, .header-menu, .header-hud, .header-quick-buttons {
  position: relative;
  top: 50%;
  -webkit-transform: translateY(-50%);
  -ms-transform: translateY(-50%);
  transform: translateY(-50%);
}

.main-content {
padding: 1% 1%;
border: solid 1px black;
margin: 1% 5%
}

.settings-button {
  position: absolute;
  top:10px;
  right: 10px;
  transform: scale(2);
}
.device {
  text-align: center;
  margin: 5px 20px;
}


.slider-container {
  min-height: 10px;
  padding: 0 1%;
}


.colour-swatch {
  background: green;
  height: 80%;
}

.brightness-swatch {
  height: 20%;
  background: grey;
}

.slider {
  margin: 10px 0;
}
#redSlider::-webkit-slider-runnable-track {
  background: pink;
}

 *:hover {
 //border: solid 1px grey;
}


/* The side navigation menu */
.sidenav {
    height: 100%; /* 100% Full-height */
    width: 0; /* 0 width - change this with JavaScript */
    position: fixed; /* Stay in place */
    z-index: 1; /* Stay on top */
    top: 0; /* Stay at the top */
    left: -2px;
    background-color: beige; /* Black*/
    overflow-x: hidden; /* Disable horizontal scroll */
    padding-top: 60px; /* Place content 60px from the top */
    transition: 0.5s; /* 0.5 second transition effect to slide in the sidenav */
    border-right: solid 2px skyblue;
}

/* The navigation menu links */
.sidenav a {
    padding: 8px 8px 8px 32px;
    text-decoration: none;
    font-size: 25px;
    color: #818181;
    display: block;
    transition-delay: 0.3s;
    transition-delay: 0.2s;
    overflow: hidden;
    white-space: nowrap;
}

/* When you mouse over the navigation links, change their color */
.sidenav a:hover {
    color: #1f1f1f;
}

/* Position and style the close button (top right corner) */
.sidenav .closebtn {
    position: absolute;
    top: 0;
    right: 25px;
    font-size: 36px;
    margin-left: 50px;
}

.fa {

}

.fa-active:hover {
  color: grey;
}

.frequent-colour-container > div {
  min-height: 50px;
  margin: 25px;
  border: solid 1px black;
}

.randomise {
  background: linear-gradient(to right, rgb(200,100,100), rgb(100,200,100), rgb(100,100,200));
}

.save-colour-block {
  margin: 0;
  padding: 0;
}

.save-colour-block > p {
  text-align: center;
  display: absolute;
  top: 50%;
  transform: translateY(50%);
  -moz-user-select: none;
  width: 100%;
  height: 100%;
}

.save-colour-icon {
  display: absolute;
  top: 50%;
  transform: translateY(50%);
}


</style>

<body>
  <div class="container-fluid" ng-app="Angular" ng-controller="hueCtrl">
    <div class="row header-bar">
    <div class="col-sm-2"><div class="header-menu" onclick="openNav()"><h4><span class="fa fa-active fa-navicon"></span>&nbsp;Menu</h4></div></div>
    <div class="col" style="text-align: center;">
      <h2 class="header-title">Homepage</h2>
    </div>
    <div class="col-sm-3"><div class="header-quick-buttons" style="position: absolute; right: 0;"><span class="fa fa-active fa-level-up" style="transform: scale(2); padding-right: 25px;"></span><span class="fa fa-active fa-camera" style="transform: scale(2);" onclick="takePhoto()"></span></div></div>
    <div class="col-sm-3" style="height: 50px;"><p class="header-hud" style="position: absolute; right: 0;"><span id="PiTemp" class="fa fa-thermometer-3">Pi Temp: --'C </span><br><span id="RoomTemp" 	class="fa fa-thermometer-1">Room Temp: --'C</span></p></div>
    </div>


    <div ng-view></div>


  <div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
  <a href="#!/" onclick="closeNav()">Control Hub</a>
  <a href="#!camera" onclick="closeNav()">Camera</a>
  <a href="#!monitor" onclick="closeNav()">Monitoring</a>
</div>
</div>
</body>
</html>

<script>
var socket = io(); //load socket.io-client and connect to the host that serves the page

var rgbDevice = [{"state":{"brightness":35},},{"state":{"brightness":35},},{"state":{"brightness":35},},];
var tempDevice = [];


var AngularApp = angular.module('Angular', ["ngRoute"]);

/* Set the width of the side navigation to 250px */
function openNav() {
    document.getElementById("mySidenav").style.width = "250px";
}

/* Set the width of the side navigation to 0 */
function closeNav() {
    document.getElementById("mySidenav").style.width = "0";
}

var extScope;
AngularApp.controller('hueCtrl', function($scope) {
      $scope.devices = [
        {"name":"Bathroom Light",
        "type":"Dimmable light",
        "id": "1",
        "state": {
          "on":true,
          "brightness":20,
          "rgb":"rgb(240,200,140)",
        },
        },
        {"name":"Bedroom Light",
        "type":"Extended color light",
        "id":"3",
        "state": {
          "on":true,
          "brightness":40,
          "rgb":"rgb(140,200,240)",
        },
        },
        {"name":"Bedside Lamp",
        "type":"Extended color light",
        "id":"4",
        "state": {
          "on":true,
          "brightness":80,
          "rgb":"rgb(200,240,140)",
        },
        },
                      ];
      $scope.red = 240;
      $scope.green = 200;
      $scope.blue = 140;
      $scope.brightness = 80;
      $scope.device = 3;
      $scope.deviceIndex = 0;
      $scope.updateSliderUI = function(deviceName, index) {
        $scope.device = deviceName.id;
        let rgb = deviceName.state.rgb.split("(")[1].split(")")[0].split(",");
        $scope.red = parseInt(rgb[0], 10);
        $scope.green = parseInt(rgb[1], 10);
        $scope.blue = parseInt(rgb[2], 10);
        $scope.brightness = deviceName.state.brightness;
        $scope.deviceIndex = index;
        rgbDevice = $scope.devices;
        socket.emit("rgbLed", rgbDevice);
      };
      $scope.dblclickOnOff = function(index) {
        if ($scope.devices[index].state.on) {
          //$scope.devices[index].state.brightness = 0;
          //$scope.brightness = 0;
          $scope.devices[index].state.on = false;
          rgbDevice = $scope.devices;
          socket.emit("rgbLed", rgbDevice);
        } else {
          //$scope.devices[index].state.brightness = 100;
          //$scope.brightness = 100;
          $scope.devices[index].state.on = true;
          rgbDevice = $scope.devices;
          socket.emit("rgbLed", rgbDevice);
        };
        //socket.emit("rgbLed", rgb);
      };
      $scope.colourUpdate = function() {
        $scope.devices[$scope.deviceIndex].state.rgb = "rgb("+$scope.red+","+$scope.green+","+$scope.blue+")";
      };
      $scope.brightnessUpdate = function() {
        $scope.devices[$scope.deviceIndex].state.brightness = $scope.brightness;
      };
      $scope.colourSave = function() {
        $(".save-colour-active").css("background","rgb("+$scope.red+","+$scope.green+","+$scope.blue+")");
      };

      $scope.showSwatch = true;
      $scope.hueAdvanced = false;
      $scope.colourInfo = false;
      $scope.hueMostUsed = true;
      extScope = $scope;
});

AngularApp.config(function($routeProvider) {
  $routeProvider
  .when("/", {
    templateUrl : "main.htm",
    controller : "hueCtrl"
  })
  .when("/monitor", {
    templateUrl : "monitor.htm"
  })
  .when("/camera", {
    templateUrl : "camera.htm"
  })
  .otherwise({
    template : "<h1>Tomato</h1><p>Tomatoes contain around 95% water.</p>"
  });
});

socket.on('hueLights', function(data) {
  tempDevice = JSON.stringify(data);
  $("html").append(JSON.parse(tempDevice).length);
  //$("html").append(JSON.parse(tempDevice)[2].state.rgb);
  for (let i = 0; i < JSON.parse(tempDevice).length; i++) {
    extScope.$apply(function(){
      extScope.devices[i].state.brightness = JSON.parse(tempDevice)[i].state.brightness;
      extScope.brightness = JSON.parse(tempDevice)[extScope.deviceIndex].state.brightness;

      //$("html").append(JSON.parse(tempDevice)[i].state.rgb.split('(')[1].split(')')[0].split(',')[1]);
      let getrgb = JSON.parse(tempDevice)[i].state.rgb.split('(')[1].split(')')[0].split(',');
      let red = getrgb[0];
      let green = getrgb[1];
      let blue = getrgb[2];
      $("html").append("rgb("+red+","+green+","+blue+")");
      extScope.devices[i].state.rgb = "rgb("+red+","+green+","+blue+")";
      let givergb = JSON.parse(tempDevice)[extScope.deviceIndex].state.rgb.split('(')[1].split(')')[0].split(',');
      extScope.red = parseInt(givergb[0]);
      extScope.green = parseInt(givergb[1]);
      extScope.blue = parseInt(givergb[2]);

  });
};
});

//window.addEventListener("load", function(){ //when page loads
$(document).ready(function() {
  var rSlider = document.getElementById("redSlider");
  var gSlider = document.getElementById("greenSlider");
  var bSlider = document.getElementById("blueSlider");
  var brightnessSlider = document.getElementById("brightnessSlider");

  var rgb = {"device":3,"red":240,"green":200,"blue":140,"brightness":80,};

  $(".device").on({
    mouseenter: function() {
        $(this).css("transform","translateY(-1px)");
    },
    mouseleave: function() {
        $(this).css("transform","translateY(0px)");
    },
    mousedown: function() {
        $(this).css("border-color","blue");
        let newDevice = $(this).attr("value");
        rgb.device = newDevice;
        socket.emit("rgbLed", rgb);
    },
    mouseup: function() {
        $(this).css("border-color","white");
    },
});

$( function() {
  $( "#resizable" ).resizable({
    minHeight: 300,
    handles: 's',
stop: function(event, ui) {
    $(this).css("width", '');
}
  });

} );

/*
  rSlider.addEventListener("change", function() { //add event listener for when red slider changes
    rgb.red = this.value; //update the RED color according to the slider
    //socket.emit("rgbLed", rgb); //send the updated color to RGB LED via WebSocket
  });

  gSlider.addEventListener("change", function() { //add event listener for when green slider changes
    rgb.green = this.value; //update the GREEN color according to the slider
    //socket.emit("rgbLed", rgb); //send the updated color to RGB LED via WebSocket
  });
  bSlider.addEventListener("change", function() { //add event listener for when blue slider changes
    rgb.blue = this.value;  //update the BLUE color according to the slider
    //socket.emit("rgbLed", rgb); //send the updated color to RGB LED via WebSocket
  });
  brightnessSlider.addEventListener("change", function() { //add event listener for when blue slider changes
    rgb.lightness = this.value;  //update the BLUE color according to the slider
    //socket.emit("rgbLed", rgb); //send the updated color to RGB LED via WebSocket
  });

  */
    $("html").append("data");
});
socket.on('piTemperatureUpdate', function(piTemp, roomTemp) {
	document.getElementById("PiTemp").innerHTML = "Pi Temp: "+piTemp;
  document.getElementById("RoomTemp").innerHTML = "Room Temp: "+roomTemp;
});

let takePhoto = function() {
  socket.emit("takePhoto");
};

</script>
